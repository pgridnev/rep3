# Практическая работа ПР-3 — README

## 1. Общее описание

Проект реализует учебную виртуальную машину (УВМ) в виде двух CLI-приложений:

- **Ассемблер**: принимает программу в человекочитаемом формате JSON и генерирует двоичный файл (3 байта на команду).
- **Интерпретатор**: читает двоичный файл, выполняет программу в модели УВМ и сохраняет дамп памяти в JSON.

Работа выполнялась поэтапно (3 этапа): ассемблер → интерпретатор/память → команда АЛУ (SHL). Этапы отражены в истории коммитов.

---

## 2. Описание всех функций и настроек

### 2.1 Ассемблер (`assembler.py`)

**Назначение:** JSON-программа → бинарный файл.

**Запуск:**
```bash
python assembler.py <src_json> <out_bin> [--test]
```

**Аргументы:**
- `<src_json>` — путь к исходному JSON-файлу с программой.
- `<out_bin>` — путь к двоичному файлу-результату.
- `--test` — режим тестирования: печатает поля/значения и байты для каждой команды (как в тестах спецификации УВМ).

**Входной формат (JSON):**
Поддерживаются два вида записи команд:

1) Массив объектов:
```json
[
  {"op": "LOAD_CONST", "arg": 290},
  {"op": "READ", "arg": 842}
]
```

2) Массив массивов:
```json
[
  ["LOAD_CONST", 290],
  ["READ", 842]
]
```

**Поддерживаемые команды (по спецификации УВМ):**
- `LOAD_CONST` (A=7)
- `READ` (A=2)
- `STORE` (A=3)
- `SHL` (A=6)

**Результат:** двоичный файл, где каждая команда кодируется 3 байтами (little-endian), по формуле:
- `value = (B << 3) | A`

---

### 2.2 Интерпретатор (`interpreter.py`)

**Назначение:** бинарный файл → выполнение → дамп памяти (JSON).

**Запуск:**
```bash
python interpreter.py <program_bin> <dump_json> [--init <init_json>] [--range <start:end>] [--mem <size>]
```

**Аргументы:**
- `<program_bin>` — путь к двоичному файлу программы (3 байта на команду).
- `<dump_json>` — путь к JSON-файлу дампа памяти.
- `--init <init_json>` — опциональный JSON с начальными значениями памяти.
- `--range <start:end>` — диапазон адресов памяти для вывода дампа (например `96:216`). Если не задан — используется диапазон по умолчанию.
- `--mem <size>` — начальный размер памяти (количество ячеек), по умолчанию достаточно для тестов.

**Модель памяти и исполнения:**
- Память данных реализована как массив целых чисел (ячейка = 32-битное значение).
- Используется стек для промежуточных значений.
- Выполняются команды:
  - `LOAD_CONST`: кладёт B на стек
  - `READ`: читает `mem[B]`, кладёт на стек
  - `STORE`: берёт со стека `base_addr`, затем `value`, пишет `mem[base_addr + B] = value`
  - `SHL`: берёт `x` со стека, читает `shift = mem[x + B]`, кладёт `(x << shift)` на стек (32-битно)

**Формат дампа памяти (JSON):**
```json
{
  "range": {"start": 96, "end": 216},
  "values": [ ... ],
  "stack": [ ... ]
}
```

---

## 3. Команды для сборки проекта и запуска тестов

Сборка не требуется (Python).

### Требования
- Python 3.10+

### Быстрая проверка “как в спецификации” (байты)
```bash
python assembler.py tests/spec_program.json out/spec.bin --test
```

### Тест копирования массива в памяти
```bash
python assembler.py tests/copy8_program.json out/copy8.bin
python interpreter.py out/copy8.bin out/copy8_dump.json --init tests/init_copy8.json --range 96:216
```

### Тест команды SHL (АЛУ)
```bash
python assembler.py tests/shl_program.json out/shl.bin
python interpreter.py out/shl.bin out/shl_dump.json --init tests/init_shl.json --range 0:512
```

---

## 4. Примеры использования

### Пример 1: проверка тестовых байтов из спецификации
```bash
python assembler.py tests/spec_program.json out/spec.bin --test
```
Ожидается вывод строк вида:
```
A=7, B=290: 0x17, 0x09, 0x00
...
```

### Пример 2: копирование 8 значений в памяти
```bash
python assembler.py tests/copy8_program.json out/copy8.bin
python interpreter.py out/copy8.bin out/copy8_dump.json --init tests/init_copy8.json --range 96:216
```
В дампе должно быть видно, что значения из диапазона `100..107` появились в `200..207`.

### Пример 3: команда SHL и сохранение результата
```bash
python assembler.py tests/shl_program.json out/shl.bin
python interpreter.py out/shl.bin out/shl_dump.json --init tests/init_shl.json --range 0:512
```
В дампе должно быть видно, что результат вычисления записан в память (как в тестовой программе).
